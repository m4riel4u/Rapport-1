<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Vérification de l'éligibilité</title>
</head>
    <body>
        <h1>Vérifier l'éligibilité pour un cours</h1>
        <a class=button href="index.html"> Retour au menu principal</a>
        <h3>Entrez les cours suivis</h3>
        <input type="text" id="completedCourses" placeholder="Ex: IFT1005,IFT1015,IFT2255" style="width: 400px;">
        <h3>Cours à vérifier</h3>
        <input type="text" id="targetCourse" placeholder="Ex: IFT2255">
        <br><br>
        <button onclick="checkEligibility()">Vérifier l'éligibilité</button>
        
        <p id="result"></p>
        <script>
        function checkEligibility() {
            const completedRaw = document.getElementById("completedCourses").value;
            const targetCourse = document.getElementById("targetCourse").value.trim();
            const resultDiv = document.getElementById("result");

            // Transformer "IFT1005, IFT1015" → ["IFT1005", "IFT1015"]
            const completedCourses = completedRaw
                .split(",")
                .map(c => c.trim().toUpperCase())
                .filter(c => c.length > 0);

            console.log("Cours complétés :", completedCourses);
            console.log("Cours cible :", targetCourse);

            fetch("/eligibility", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    completedCourses: completedCourses,
                    targetCourse: targetCourse
                })
            })
            .then(res => res.json())
            .then(data => {
                resultDiv.innerHTML = data.eligible
                    ? " Éligible"
                    : " Non éligible<br>Pré-requis manquants : " + data.missing.join(", ");
            })
            .catch(err => {
                console.error(err);
                resultDiv.textContent = "Erreur lors de la vérification.";
            });
        }
        </script>

    </body>
</html>