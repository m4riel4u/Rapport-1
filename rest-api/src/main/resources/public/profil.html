<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Créer ou modifier un profil</title>
</head>
    <body>

    <h1>Créer ou modifier mon profil</h1>
    <a class=button href="index.html"> Retour au menu principal</a>
    <br><br>

    <h3>Informations du profil</h3>

    <p>Entrer votre nom</p>
    <input type="text" id="name" placeholder="Nom"><br><br>

    <p>Entrer votre courriel</p>
    <input type="email" id="email" placeholder="exemple@exemple.com"><br><br>

    <p>Sélectionner votre cycle</p>
    <select id="cycle">
        <option>Baccalauréat</option>
        <option>Maîtrise</option>
        <option>Doctorat</option>
    </select><br><br>
    <p>Entrer les cours suivis (séparés par des virgules)</p>
    <input type="text" id="completedCourses" placeholder="Ex: IFT1005, IFT1015, IFT2255" style="width: 400px;"><br><br>
    
    <h3>Votre identifiant</h3>
    <p>Pour modifier ou supprimer votre profil, veuillez entrer votre ID.</p>
    <input type="number" id="userId" placeholder="Ex: 3"><br><br>

    <button onclick="createProfile()">Créer</button>
    <button onclick="updateProfile()">Modifier mon profil</button>

    <h3>Supprimer mon profil</h3>
    <button onclick="deleteProfile()">Supprimer mon profil</button>

    <p id="result"></p>


        <script>
        function createProfile() {
            fetch("/users", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: document.getElementById("name").value,
                    email: document.getElementById("email").value,
                    cycle: document.getElementById("cycle").value,
                    completedCourses: getCompletedCourses()
                })
            })
            .then(res => res.json())
            .then(user => {
                localStorage.setItem("userId", user.id);
                document.getElementById("result").textContent =
                    "Profil créé ! ID utilisateur : " + user.id+ ". Conservez-le précieusement pour pouvoir modifier ou supprimer votre profil.";
            })
            .catch(() => {
                document.getElementById("result").textContent =
                    "Erreur lors de la création du profil.";
            });
        }
       
        function updateProfile() {
            const userId = document.getElementById("userId").value;

            if (!userId) {
                alert("Veuillez entrer votre ID utilisateur.");
                return;
            }

            fetch(`/users/${userId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: document.getElementById("name").value,
                    email: document.getElementById("email").value,
                    cycle: document.getElementById("cycle").value,
                    completedCourses: getCompletedCourses()
                })
            })
            .then(response => {
                if (response.ok) {
                    document.getElementById("result").textContent =
                        "Profil modifié avec succès.";
                } else {
                    document.getElementById("result").textContent =
                        "Erreur : ID invalide.";
                }
            })
            .catch(() => {
                document.getElementById("result").textContent =
                    "Erreur lors de la modification.";
            });
        }

        function deleteProfile() {
            const userId = document.getElementById("userId").value;

            if (!userId) {
                alert("Veuillez entrer votre ID utilisateur.");
                return;
            }

            if (!confirm("Êtes-vous sûr de vouloir supprimer votre profil ?")) {
                return;
            }

            fetch(`/users/${userId}`, {
                method: "DELETE"
            })
            .then(response => {
                if (response.status === 204) {
                    document.getElementById("result").textContent =
                        "Profil supprimé avec succès.";
                } else {
                    document.getElementById("result").textContent =
                        "Aucun profil trouvé avec cet ID.";
                }
            })
            .catch(() => {
                document.getElementById("result").textContent =
                    "Erreur lors de la suppression.";
            });
        }

        function getCompletedCourses() {
            return document.getElementById("completedCourses").value
                .split(",")
                .map(c => c.trim().toUpperCase())
                .filter(c => c.length > 0);
        }

        </script>

    </body>
</html>
